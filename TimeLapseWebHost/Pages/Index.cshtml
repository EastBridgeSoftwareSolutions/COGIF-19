@page
@model IndexModel
@inject IFileStore _fileStore
@{
    ViewData["Title"] = "Home page";
}

    <div>
        <h1 class="display-4">Welcome</h1>

        @{
            if (User.Identity.IsAuthenticated)
            {
                <div class="flex flex-row justify-between">
                    @if (_fileStore.UserHasGif(User))
                    {
                        <article x-data="data()" x-init="initCamera" class="inline-block overflow-hidden rounded-lg shadow-lg">
                            <img src="@(_fileStore.GetRelativeGifPath(User))" />
                        </article>

                        
                    }

                    <article x-data="data()" x-init="initCamera" class="inline-block overflow-hidden rounded-lg shadow-lg">

                        <video x-ref="video" x-show="!snapped" x-bind:width="gif.width" x-bind:height="gif.height" autoplay></video>
                        <canvas x-ref="canvas" x-show="snapped" x-bind:width="gif.width" x-bind:height="gif.height"></canvas>

                        <footer class="flex flex-row-reverse items-center justify-between leading-none p-2 md:p-4">
                            <button x-show="!snapped" @@click="snap" type="button" class="btn btn-secondary">Snap Photo</button>
                            <button x-show="snapped" @@click="submit" type="button" class="btn btn-primary">Save Photo</button>
                            <button x-show="snapped" @@click="cancel" type="button" class="btn btn-danger">Try again</button>
                        </footer>

                    </article>
                </div>
            }
        }
    </div>

@section Scripts
{
    <script src="~/js/index.js" asp-append-version="true"></script>
}